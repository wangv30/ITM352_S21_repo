<script src="./product_data.js" type="text/javascript"></script> 
<!-- code above taken from Assignment 1 instructions -->

<!-- code taken and altered from SmartPhoneProducts3 -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Water Bottle Products</title>
    <link rel="stylesheet" href="products-style.css">
</head>
<body>
    <h1>Vincent's Water Bottle Store</h1>
    <h1>Water Bottle Store</h1>
    <form name="process_form" action="./process_form" method="POST">
    <div>
    <main> 
    <script>
        // displays product information
        for (var i = 0; i < products.length; i++) {
        document.write(`
    </section>
        <section class="item"> 
        <h2>${products[i].brand}</h2>
        <p>\$${products[i].price}</p>
        <label>Quantity</label>
        <input type = "text" placeholder = "0" name="quantity${i}">
        <img src= "./images/${products[i].image}""> 
    </section>
    `)
}
</script>
</main>
</div> 
    <input name= "purchase_submit_button" type="submit" value="Purchase!">
</form>
<h1>Your One Stop Water Bottle Shop</h1>
</body>
</html> <img src="" alt="">

<script>
    function isNonNegInt(val, returnErrors) {
        /* This function returns true if value is a non-negative integer. Copied from Lab 12.*/
        errors = []; // assume no errors at first
        if (Number(val) != val) errors.push('Not a number!'); // Checks if string is a number value
        if (val < 0) errors.push('Negative value!'); // Check if it is non-negative
        if (parseInt(val) != val) errors.push('Not an integer!'); // Check that it is an integer
        return returnErrors ? errors : ((errors.length == 0) ? false : true);
    }
    function checkQuantityTextbox(theTextbox) {
        /*Returns text of how many items are being purchased if amount in textbox has no errors */
        errs = isNonNegInt(theTextbox.value, true);
        if (errs.length == 0) errs = ['You want:']; 
        if (theTextbox.value.trim() == '') errs = ['Quantity'];
        document.getElementById(theTextbox.name + '_label').innerHTML = errs.join(", ");
    }
    window.onload = function () {
        let params = (new URL(document.location)).searchParams;
        if (params.has('submitPurchase')) {
        has_errors = false; // assumes quantities have no errors
        total_qty = 0;
        //Displays name, image, and price for each product
        for (i = 0; i < products.length; i++) {
        if (params.has(`quantity${i}`)) { a_qty = params.get(`quantity${i}`);
            product_form[`quantity${i}`].value = a_qty;
            total_qty += a_qty;
        if (!isNonNegInt(a_qty)) {
            has_errors = true; // invalid quantity
            checkQuantityTextbox(product_form[`quantity${i}`]); // points out the error 
        }
            }
        }
    }
}
</script>