<script src="products.js" type="text/javascript"></script>
<!-- Links to my products array within products.js -->
<!-- code above taken from Assignment 1 instructions -->

<script>
        // code taken from lab12 order_page_Ex3.html and example code in assignment instructions
    function checkQuantityTextbox(theTextbox) {
        errs = isNonNegInt(theTextbox.value, true);
        if (errs.length == 0) errs = ['You want:'];
        if (theTextbox.value.trim() == '') errs = ['Quantity'];
        document.getElementById(theTextbox.name + '_label').innerHTML = errs.join(", ");
    }
    
    // function code from Invoice4
    function isNonNegInt(q, returnErrors = false) {
    var errors = []; // assume that there are no errors
    if(q == " ") q = 0; // Considers blank inputs as 0
    if(Number(q) != q) errors.push('Not a number!'); // Check if string is number
    else if(q < 0) errors.push('Negative value!'); // Check if non-negative
    else if(parseInt(q) != q) errors.push('Not an integer!'); // Check if integer
    return returnErrors ? errors : (errors.length == 0);
}

// Code taken from examples provided in Assingment1 instructions
window.onload = function () {
        let params = (new URL(document.location)).searchParams; // gets query string
        // check if quantities are valid. IF valid then redirect to invoice
        if (params.has('purchase_submit')) {
            has_errors = false; // assume quantities are valid
            total_qty = 0; 
            for (i = 0; i < products.length; i++) {
                if (params.has(`quantity${i}`)) {
                    a_qty = params.get(`quantity${i}`);
                    // Sticky textboxes
                    product_selection_form[`quantity${i}`].value = a_qty;
                    total_qty += a_qty; 
                    if(!isNonNegInt(a_qty)) {
                        has_errors = true; //invalid quantity error
                        checkQuantityTextbox(product_selection_form[`quantity${i}`]); // show where the error is
                    }
                }
            }
            // Respond to errors or redirect to invoice if no errors
            if(has_errors) {
                alert("Please enter only valid quantities!");
            } else if(total_qty == 0) { // if no quantity selection then alert
                alert("Please select some quantities!");
            } else { // Displays invoice
                window.location = `./invoice.html${document.location.search}`;
                window.stop;
            }
        }
    }
</script>


<!DOCTYPE html>
<html>
<title>Hydro Store</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Karma">
<style>
body,h1,h2,h3,h4,h5,h6 {font-family: "Karma", sans-serif}
.w3-bar-block .w3-bar-item {padding:20px}
</style>
<body>
<form name="product_selection_form" action="" method="GET">
<!-- Top menu -->
<div class="w3-top">
  <div class="w3-white w3-xlarge" style="max-width:1200px;margin:auto">
    <div class="w3-right w3-padding-16"><input name= "purchase_submit" type="submit" value="Hydrate!"></div>
    <div class="w3-center w3-padding-16"> Hydro Store </div>
  </div>
</div>
  
<!-- !PAGE CONTENT! -->
<div class="w3-main w3-content w3-padding" style="max-width:1200px;margin-top:100px">

<script>
    // displays product information and images
    for (var i = 0; i < products.length; i++) {
    document.write(`
</section>
    <section class="item"> 
    <h2>${products[i].brand}</h2>
    <p>\$${products[i].price}</p>
    <label id="quantity${i}_label"}">Quantity</label>
    <input type = "text" 
    placeholder = "0" 
    name="quantity${i}" 
    onkeyup="checkQuantityTextbox(this);">
    <img src= "./images/${products[i].image}"> 
</section>
`)
}
</script>
  <!-- Footer -->
  <footer class="w3-row-padding w3-padding-32">
    <div class="w3-third">
      <h3>Thanks For Shopping</h3>
      <p>Powered by <a href="https://www.w3schools.com/w3css/default.asp" target="_blank">w3.css</a></p>
    </div>
</form>
</script>

</body>
</html>
