<script src="products.js" type="text/javascript"></script>
<!-- Links to my products array within products.js -->
<!-- code above taken from Assignment 1 instructions -->

<script>
        // code taken from lab12 order_page_Ex3.html and example code in assignment instructions
    function checkQuantityTextbox(theTextbox) {
        errs = isNonNegInt(theTextbox.value, true);
        if (errs.length == 0) errs = ['You want:'];
        if (theTextbox.value.trim() == '') errs = ['Quantity'];
        document.getElementById(theTextbox.name + '_label').innerHTML = errs.join(", ");
    }
    
    // function code from Invoice4
    function isNonNegInt(q, returnErrors = false) {
    var errors = []; // assume that there are no errors
    if(q == " ") q = 0; // Considers blank inputs as 0
    if(Number(q) != q) errors.push('Not a number!'); // Check if string is number
    else if(q < 0) errors.push('Negative value!'); // Check if non-negative
    else if(parseInt(q) != q) errors.push('Not an integer!'); // Check if integer
    return returnErrors ? errors : (errors.length == 0);
}

// Code taken from examples provided in Assingment1 instructions
window.onload = function () {
        let params = (new URL(document.location)).searchParams; // gets query string
        // check if quantities are valid. IF valid then redirect to invoice
        if (params.has('purchase_submit')) {
            has_errors = false; // assume quantities are valid
            total_qty = 0; 
            for (i = 0; i < products.length; i++) {
                if (params.has(`quantity${i}`)) {
                    a_qty = params.get(`quantity${i}`);
                    // Sticky textboxes
                    product_selection_form[`quantity${i}`].value = a_qty;
                    total_qty += a_qty; 
                    if(!isNonNegInt(a_qty)) {
                        has_errors = true; //invalid quantity error
                        checkQuantityTextbox(product_selection_form[`quantity${i}`]); // show where the error is
                    }
                }
            }
            // Respond to errors or redirect to invoice if no errors
            if(has_errors) {
                alert("Please enter only valid quantities!");
            } else if(total_qty == 0) { // if no quantity selection then alert
                alert("Please select some quantities!");
            } else { // Displays invoice
                window.location = `./invoice.html${document.location.search}`;
                window.stop;
            }
        }
    }
</script>

<!-- code taken and altered from SmartPhoneProducts3 -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Water Bottle Products</title>
    <link rel="stylesheet" href="products-style.css">
</head>
<body>
    <h1>Vincent's Water Bottle Store</h1>
    <h1>Water Bottle Store</h1>
    <form name="product_selection_form" action="" method="GET">
    <div>
    <main> 
    <script>
        // displays product information and images
        for (var i = 0; i < products.length; i++) {
        document.write(`
    </section>
        <section class="item"> 
        <h2>${products[i].brand}</h2>
        <p>\$${products[i].price}</p>
        <label id="quantity${i}_label"}">Quantity</label>
        <input type = "text" 
        placeholder = "0" 
        name="quantity${i}" 
        onkeyup="checkQuantityTextbox(this);">
        <img src= "./images/${products[i].image}"> 
    </section>
    `)
}
</script>
</main>
</div> 
    <input name= "purchase_submit" type="submit" value="Purchase!">
</form>
<h1>Your One Stop Water Bottle Shop</h1>
</body>
</html>
